digraph G
{
        rankdir = TD;
        compound=true;
        penwidth=2;
        node [fontname="Times Roman", shape=rectangle, fontsize=40, penwidth=2]
        edge [color=black, fontname="Times Roman", weight=100, penwidth=2, arrowsize=2]

        Typechecking []
        Renamer []
        Fusion []
        Output [label="Optimised program", shape=none]
        TupleTransform [label="Tuple transformation"]
        Normalisation [label="Tuple and\nlet normalisation"]
        EnablingOpts [label="Enabling optimisations", style=filled]

        {rank=same; Fusion Normalisation}
        {rank=same; Output Renamer}
        {rank=same; TupleTransform EnablingOpts}

        subgraph clusterEnabling {
                Inlining []
                rank="same"
                style=filled
                Inlining
                DeadCodeRemoval [label="Dead code remover"]
                ConstProp [label="Copy propagation \nand constant folding"]
                Loop [label="Loop?"]
                {rank=same; Inlining Loop}
                {rank=same; ConstProp DeadCodeRemoval}
                Inlining->ConstProp->DeadCodeRemoval->Loop
                Loop->Inlining[style=dashed]
                label="Enabling optimisations"
                labelloc=b
                fontname="Times Roman"
                fontsize=40
        }

        Typechecking->Renamer->TupleTransform->Normalisation->Inlining
        Loop->Fusion->EnablingOpts->Output
}
