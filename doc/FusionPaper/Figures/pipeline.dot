digraph G
{
        rankdir = TD;
        compound=true;
        penwidth=2;
        node [fontname="Times Roman", shape=rectangle, fontsize=40, penwidth=2]
        edge [color=black, fontname="Times Roman", weight=100, penwidth=2, arrowsize=2]

        Typechecker []
        Renamer []
        Fusion []
        Output [label="Code generator"]
        TupleTransform [label="Tuple transform"]
        Normalisation [label="Tuple and\nlet normalisation"]
        EnablingOpts [label="Enabling optimisations", style=filled]

        {rank=same; Fusion Normalisation}
        {rank=same; Output Renamer}
        {rank=same; TupleTransform EnablingOpts}

        subgraph clusterEnabling {
                Inlining []
                rank="same"
                style=filled
                Inlining
                DeadCodeRemoval [label="Dead code removal"]
                ConstProp [label="Constant and\ncopy propagation"]
                Loop [label="Loop?"]
                {rank=same; Inlining Loop}
                {rank=same; ConstProp DeadCodeRemoval}
                Inlining->ConstProp->DeadCodeRemoval->Loop
                Loop->Inlining[style=dashed]
                label="Enabling optimisations"
                labelloc=b
                fontname="Times Roman"
                fontsize=40
        }



        Typechecker->Renamer->TupleTransform->Normalisation->Inlining
        Loop->Fusion->EnablingOpts->Output
}
